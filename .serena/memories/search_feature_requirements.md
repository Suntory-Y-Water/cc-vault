# 検索機能要件定義書

## 1. ビジネス要件

### 1.1 目的
- **主目的**: 技術記事キュレーションにおける記事発見性の向上
- **副目的**: ユーザーの記事アクセス効率化と滞在時間向上
- **成功指標**: 検索機能利用率、検索からの記事アクセス率

### 1.2 対象ユーザー
- **プライマリ**: Claude Code利用者（技術者・開発者）
- **ユースケース**: 
  - 特定技術要素の記事検索（例: "serena", "MCP", "TypeScript"）
  - 過去閲覧記事の再発見
  - トレンド記事の絞り込み検索

### 1.3 ビジネス制約
- **開発コスト**: 最小限（DB変更なし、既存コンポーネント最大活用）
- **運用コスト**: 追加インフラなし（既存Cloudflare D1活用）
- **リリース時期**: 単一スプリントでの完了

## 2. 機能要件

### 2.1 検索機能（主機能）
- **検索対象**: articlesテーブルのtitleカラムのみ
- **検索方式**: 部分一致検索（LIKE演算子）
- **大文字小文字**: 区別しない（COLLATE NOCASE）
- **最小文字数**: 制限なし（1文字から検索可能）
- **最大文字数**: 100文字（URL長制限考慮）

### 2.2 検索UI（入力部）
- **配置場所**: ヘッダー部分（全ページ共通）
- **入力方式**: テキストボックス + 検索ボタン
- **実行トリガー**: Enterキー押下 または 検索ボタンクリック
- **バリデーション**: 空文字チェックのみ
- **プレースホルダー**: "キーワードを入力..."

### 2.3 検索結果表示
- **URL形式**: `/search?q={キーワード}&page={ページ}&site={サイト}&order={順序}`
- **レイアウト**: 既存記事一覧ページと同一構造
- **表示件数**: 24件/ページ（既存ページと同一）
- **空状態メッセージ**: `{検索キーワード} の検索結果が見つかりませんでした`

### 2.4 フィルタ・ソート機能
- **サイトフィルタ**: 既存SiteFilterコンポーネント活用
  - 全て、Zenn、Qiita、はてなブックマーク
- **ソート機能**: 既存MainTabsコンポーネント活用
  - 新着順（latest）、トレンド順（trending）
- **フィルタ適用**: 検索結果に対してサイト・ソート条件を重畳適用

### 2.5 ページネーション
- **実装**: 既存Paginationコンポーネント活用
- **URL管理**: 検索パラメータ保持（q, site, orderパラメータ継承）
- **表示条件**: 総ページ数が2ページ以上の場合のみ表示

## 3. 技術要件

### 3.1 アーキテクチャ原則
- **RSC使用**: React Server Components（APIエンドポイント作成禁止）
- **責任分散**: 検索専用ページ作成（src/app/page.tsxに機能追加禁止）
- **コンポーネント再利用**: 既存UIコンポーネント最大活用
- **型安全性**: TypeScript厳密型チェック

### 3.2 データベース要件
- **テーブル**: 既存articlesテーブル使用（変更なし）
- **インデックス**: 既存インデックス活用（新規作成なし）
- **パフォーマンス**: 既存ページネーション関数と同等性能

### 3.3 ファイル構成
```
src/app/search/
└── page.tsx                    # 検索結果ページ（新規）

src/lib/cloudflare.ts          # searchArticles関数追加

src/types/api.ts               # SearchParams型追加

src/components/search/
└── SearchBox.tsx              # 検索ボックス（新規）

src/components/layout/
└── Header.tsx                 # 検索ボックス統合（変更）
```

## 4. 品質要件

### 4.1 設計原則
- **契約による設計**: 関数仕様の明確化、事前・事後条件定義
- **型安全性**: TypeScript strict mode、実行時型チェック回避
- **関数ベース**: クラス使用禁止、純粋関数優先
- **可読性**: JSDocコメント必須、意図明確な命名

### 4.2 コーディング規約
- **配列型**: `T[]`記法（`Array<T>`禁止）
- **型定義**: typeキーワード（interface禁止）
- **引数**: 2個以上の場合オブジェクト形式

### 4.3 テスト要件
- **単体テスト**: searchArticles関数の境界値テスト
- **型チェック**: `pnpm run typecheck`通過
- **リント**: `pnpm run lint`エラーなし
- **統合チェック**: `pnpm run ai-check`実行

## 5. 非機能要件

### 5.1 パフォーマンス
- **初回表示**: 2秒以内（既存ページと同等）
- **検索実行**: 1秒以内（小規模データセット前提）
- **メモリ使用量**: 既存ページと同等

### 5.2 ユーザビリティ
- **レスポンシブ**: モバイル・デスクトップ対応
- **アクセシビリティ**: キーボードナビゲーション対応
- **一貫性**: 既存UIパターンとの統一

### 5.3 セキュリティ
- **入力値検証**: XSS対策（React標準エスケープ）
- **SQLインジェクション**: Drizzle ORMパラメータ化クエリ
- **レート制限**: なし（Cloudflare Workers標準制限に依存）

## 6. 制約事項・除外事項

### 6.1 今回実装しない機能
- **複数フィールド検索**: author, content検索
- **検索履歴**: ローカルストレージ保存
- **検索サジェスト**: 候補表示機能
- **高度検索**: AND/OR演算子
- **全文検索**: 記事本文の検索

### 6.2 技術的制約
- **DB変更禁止**: スキーマ変更、マイグレーション禁止
- **外部サービス禁止**: Elasticsearch等の検索エンジン使用不可
- **クライアント状態管理**: Context/Redux等の状態管理ライブラリ使用不可

### 6.3 運用制約
- **ログ出力**: 検索クエリログ収集なし
- **分析機能**: 検索パフォーマンス分析なし
- **A/Bテスト**: UI改善テスト実施なし

## 7. 受入条件

### 7.1 機能受入条件
1. ヘッダーに検索ボックスが表示されること
2. 検索実行で`/search?q=keyword`に遷移すること
3. 検索結果が既存記事一覧と同じ形式で表示されること
4. サイトフィルタ・ソート機能が検索結果で利用可能なこと
5. 空検索結果で適切なメッセージが表示されること
6. ページネーションが正常動作すること

### 7.2 品質受入条件
1. `pnpm run ai-check`が通過すること
2. 全JSDocコメントが記載されていること
3. 既存コーディング規約に準拠していること
4. RSCパターンで実装されていること

### 7.3 パフォーマンス受入条件
1. 検索結果表示が2秒以内に完了すること
2. 既存ページのパフォーマンスが劣化しないこと