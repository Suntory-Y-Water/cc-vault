# タイムゾーン変換における重要な問題と学習事項

## 発生した問題
- `toZonedTime` が Cloudflare Workers で期待通りに動作しない
- 手動オフセット計算（UTC + 9時間）は危険でサマータイム等を考慮できない
- 週計算で正しい結果が得られない問題が発生

## toZonedTime の正しい理解
- `toZonedTime` は**表示用の Date オブジェクト**を返す
- **内部的な UTC 値は変更されない**（これは仕様）
- 計算用途には不適切、表示用途にのみ使用すべき

## 推奨アプローチ
1. **計算はUTCベース**: 週計算等はUTCで行う
2. **表示時のみ変換**: `formatInTimeZone` や `toLocaleString()` を使用
3. **手動計算禁止**: サマータイム、うるう秒等のエッジケースで危険

## 学習したライブラリの正しい使い方
- `formatInTimeZone`: 表示目的での推奨関数
- `toZonedTime`: 表示用Dateオブジェクト作成（計算に使用不可）
- `fromZonedTime`: 特定タイムゾーンの時刻をUTCに変換

## 今後の対応方針
- タイムゾーン変換が必要な計算ロジックの根本的見直しが必要
- 危険な手動計算の排除
- ライブラリの正しい使用方法の徹底