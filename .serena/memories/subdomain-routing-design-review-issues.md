# Subdomain Routing設計レビュー指摘事項

## コーディング規約違反

- **interfaceではなくtype使用**: 設計でinterfaceを多用している
- **構造的型づけ**: アサーション必要時のユーザー許可求める仕組みなし
- **Function宣言**: 見通し向上のためFunction宣言で実装
- **引数オブジェクト形式**: 2個以上の引数は必ずオブジェクト形式
- **クラス使用禁止**: 関数ベース実装に統一
- **既存型定義活用**: Pick/Omit等の活用
- **配列型定義**: `Array<T>`ではなく`[]`記法

## 全体設計の根本的問題

### CSR使用最小限原則違反
- useEffect多用による不要なクライアントサイド処理
- サーバーコンポーネント中心実装への転換必要

## 具体的設計課題

### 1. design.md の問題点

**ミドルウェア作成意図不明**
- middleware.tsの必要性が不明確
- layout.tsxでの直接処理で十分

**データアクセスラッパー作成意図不明**
- 複雑なラッパー層の追加理由が不明
- 既存のcloudflare.ts拡張で十分

**useEffect不要なテーマ適用**
- page.tsxでホスト名→AIエージェント特定
- Props経由でサーバーコンポーネント実装可能

**APIエンドポイント不要**
- データ取得は既存page.tsxのサーバー関数で十分
- D1への直接SQL実行で対応可能

**RLS誤解**
- D1にはRow Level Security機能なし
- context7 MCPで確認済み

**KV使用意図不明**
- Next.js標準ISRキャッシュで十分
- 不要な複雑性追加

**設定ファイル形式間違い**
- wrangler.tomlは廃止
- @wrangler.jsonc が正しい形式

### 2. ui-components.md の問題点

**テナントContextプロバイダー不要**
- 新規Context Providerの追加理由不明
- Props渡しでサーバーコンポーネント実装可能

**CSRでのテナント切り替え不要**
- クライアントサイド切り替えは不適切
- Props経由のサーバーサイド実装が適切

**動的テーマプロバイダー不要**
- 動的テーマ変更の複雑性が不要
- 静的CSS + data-attribute で十分

**フォント変更スコープ外**
- フォント変更は実装しない
- 表示内容・色・ヘッダータイトルのみ変更

**テナント別カードコンポーネント不要**
- 新規コンポーネント作成不要
- 既存コンポーネントの設定変更で対応

### 3. database-schema.md の問題点

**新規テーブル追加理由不明**
- tenants, tenant_articles等の複雑なテーブル群
- 既存articlesテーブルのAIエージェント区分カラムで十分

**記事重複考慮不足**
- 記事の重複表示防止機能が不明確
- 単純なフィルタリングで対応可能

**テナント設定履歴テーブル不要**
- tenant_config_historyの実装意図不明
- 静的設定管理で履歴不要

**その他テーブル実装意図不明**
- tenant_weekly_reports等の複雑なテーブル群
- 既存週次レポート機能の拡張で十分

## 推奨される簡素化方針

1. **データベース**: ai_agentカラム1つのみ追加
2. **フロントエンド**: サーバーコンポーネント中心、Props渡し
3. **テーマ**: data-attribute + 静的CSS
4. **設定**: 静的設定ファイル管理
5. **キャッシュ**: Next.js ISR活用
6. **API**: 不要、サーバー関数で直接処理