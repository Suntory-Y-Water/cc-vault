# 中間関数（ラッパー関数）リファクタリングの学習事項

## 実装時のミス事例

### 対象: src/lib/weekly-report.ts の中間関数削除

## ミスした内容

1. **単純ラッパーと重要契約の区別を誤った**
   - 全ての中間関数を「単純なラッパー」として一律削除
   - `getStartOfWeek` と `formatDateToString` の重要性を見落とし

2. **使用頻度と契約の重要性を軽視**
   - `getStartOfWeek`: 8箇所で使用、`{ weekStartsOn: 1 }` は「月曜日始まり」の重要契約
   - `formatDateToString`: 4箇所で使用、`'yyyy-MM-dd'` はプロジェクト統一形式の契約

3. **契約による設計の本質理解不足**
   - 中間関数の削除により契約の意図が不明確になった
   - マジックナンバー・マジック文字列が散らばって保守性が低下

## 正しい中間関数の判断基準

### 削除すべき中間関数
- 使用箇所が少ない（1-2箇所）
- パラメータ固定だけで意図が自明
- 例: `convertUTCToJST`（未使用だったため削除）

### 保持すべき中間関数
- 複数箇所で使用（3箇所以上）
- 重要なビジネスルール・統一規約を表現
- パラメータの意図が不明確になる可能性
- 例: `getStartOfWeek`（週の開始日定義）、`formatDateToString`（日付形式統一）

## 実装時のチェックリスト

### 削除前の確認項目
1. **使用箇所の数** - `grep` で全プロジェクトの使用箇所を確認
2. **契約の重要性** - パラメータが重要なビジネスルール・統一規約を表現するか
3. **意図の明確性** - 削除後にマジックナンバー・文字列の意図が分からなくなるか
4. **将来の変更性** - 定義変更時に複数箇所修正が必要になるか

### 復旧時の対応
1. **適切なコメント** - 「プロジェクト全体で統一された〇〇の定義」
2. **契約の明示** - 関数名で契約内容を表現
3. **段階的修正** - 関数追加 → 使用箇所修正 → 不要インポート削除

## 学んだ教訓

1. **中間関数の価値を契約で判断**
   - 単純なラッパーでも重要な契約を表現する場合は保持

2. **削除の影響範囲を慎重に評価**
   - 全プロジェクトでの使用状況を必ず確認

3. **ビジネスルールの抽象化の重要性**
   - 「月曜日始まり」「統一日付形式」等は中間関数で表現すべき

4. **段階的なリファクタリング**
   - 一括削除ではなく、各関数の価値を個別に判断